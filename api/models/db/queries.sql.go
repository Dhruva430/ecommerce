// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries.sql

package db

import (
	"context"
	"database/sql"
)

const createAccount = `-- name: CreateAccount :exec
INSERT INTO account (account_id, provider, password, user_id)
VALUES ($1, $2, $3, $4)
`

type CreateAccountParams struct {
	AccountID string         `json:"account_id"`
	Provider  Provider       `json:"provider"`
	Password  sql.NullString `json:"password"`
	UserID    int64          `json:"user_id"`
}

func (q *Queries) CreateAccount(ctx context.Context, arg CreateAccountParams) error {
	_, err := q.db.ExecContext(ctx, createAccount,
		arg.AccountID,
		arg.Provider,
		arg.Password,
		arg.UserID,
	)
	return err
}

const createUser = `-- name: CreateUser :one
INSERT INTO "user" (email, role)
VALUES ($1, $2) 
RETURNING id, email, role
`

type CreateUserParams struct {
	Email string `json:"email"`
	Role  Role   `json:"role"`
}

type CreateUserRow struct {
	ID    int64  `json:"id"`
	Email string `json:"email"`
	Role  Role   `json:"role"`
}

func (q *Queries) CreateUser(ctx context.Context, arg CreateUserParams) (CreateUserRow, error) {
	row := q.db.QueryRowContext(ctx, createUser, arg.Email, arg.Role)
	var i CreateUserRow
	err := row.Scan(&i.ID, &i.Email, &i.Role)
	return i, err
}

const getCart = `-- name: GetCart :many
SELECT c.id AS cart_id, c.amount, p.id AS product_id, p.title, p.price, p.discounted,
       p.image_url, s.shop_name
FROM cart c
JOIN product p ON p.id = c.product_id
JOIN seller s ON s.id = p.seller_id
WHERE c.user_id = $1
`

type GetCartRow struct {
	CartID     int64          `json:"cart_id"`
	Amount     int32          `json:"amount"`
	ProductID  int64          `json:"product_id"`
	Title      string         `json:"title"`
	Price      float64        `json:"price"`
	Discounted sql.NullInt32  `json:"discounted"`
	ImageUrl   string         `json:"image_url"`
	ShopName   sql.NullString `json:"shop_name"`
}

func (q *Queries) GetCart(ctx context.Context, userID int64) ([]GetCartRow, error) {
	rows, err := q.db.QueryContext(ctx, getCart, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetCartRow
	for rows.Next() {
		var i GetCartRow
		if err := rows.Scan(
			&i.CartID,
			&i.Amount,
			&i.ProductID,
			&i.Title,
			&i.Price,
			&i.Discounted,
			&i.ImageUrl,
			&i.ShopName,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removeFromCart = `-- name: RemoveFromCart :exec
DELETE FROM cart WHERE user_id = $1 AND product_id = $2
`

type RemoveFromCartParams struct {
	UserID    int64 `json:"user_id"`
	ProductID int64 `json:"product_id"`
}

func (q *Queries) RemoveFromCart(ctx context.Context, arg RemoveFromCartParams) error {
	_, err := q.db.ExecContext(ctx, removeFromCart, arg.UserID, arg.ProductID)
	return err
}

const updateCart = `-- name: UpdateCart :exec
UPDATE cart
SET amount = $3
WHERE user_id = $1
AND product_id = $2
`

type UpdateCartParams struct {
	UserID    int64 `json:"user_id"`
	ProductID int64 `json:"product_id"`
	Amount    int32 `json:"amount"`
}

func (q *Queries) UpdateCart(ctx context.Context, arg UpdateCartParams) error {
	_, err := q.db.ExecContext(ctx, updateCart, arg.UserID, arg.ProductID, arg.Amount)
	return err
}
